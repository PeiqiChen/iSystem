USE iSystem;

CREATE TABLE student(
  sid CHAR(10) PRIMARY KEY,
  sname CHAR(20),
  sex CHAR,
  entry_age INTEGER,
  entry_year INTEGER,
  clazz INTEGER
);


CREATE TABLE course(
  cid CHAR(7) PRIMARY KEY ,
  cname CHAR(20),
  tname CHAR(20),
  credit INTEGER,
  fit_grade INTEGER,
  cancel_year INTEGER
);

CREATE TABLE information(
  student_id CHAR(10) NOT NULL,
  course_id CHAR(7) NOT NULL,
  involved_year INTEGER NOT NULL ,
  score INTEGER,
  PRIMARY KEY (student_id, course_id),
   FOREIGN KEY (student_id) REFERENCES student(sid)
     ON DELETE CASCADE,
  FOREIGN KEY (course_id) REFERENCES course(cid)
      ON DELETE CASCADE
  CHECK ((involved_year-(SELECT entry_year FROM student WHERE sid =student_id))>=(SELECT fit_grade FROM course WHERE cid=course_id)),
  CHECK ( involved_year < (SELECT cancel_year FROM course WHERE cid=course_id) )
);


INSERT INTO student (sid, sname, sex, entry_age, entry_year, clazz) VALUES
  ("2010000001","赵大","男",10,2010,1),
  ("2010000002","钱大","女",10,2010,1),
  ("2010000003","孙大","男",10,2010,1),
  ("2010000004","李大","女",10,2010,1),
  ("2010000005","周大","男",11,2010,2),
  ("2010000006","吴大","女",11,2010,2),
  ("2010000007","郑大","男",11,2010,2),
  ("2010000008","王大","女",11,2010,2),

  ("2018000001","赵小","男",10,2018,1),
  ("2018000002","钱小","女",10,2018,1),
  ("2018000003","孙小","男",10,2018,1),
  ("2018000004","李小","女",10,2018,1),
  ("2018000005","周小","男",11,2018,2),
  ("2018000006","吴小","女",11,2018,2),
  ("2018000007","郑小","男",11,2018,2),
  ("2018000008","王小","女",11,2018,2);

INSERT INTO course(cid, cname, tname, credit, fit_grade, cancel_year) VALUES
  ("1970101","数学","冯数学",5,1,NULL ),
  ("1970102","语文","陈语文",5,1,NULL ),
  ("1970103","英语","诸英语",5,1,NULL ),

  ("2000304","政治","卫思政",3,1,NULL ),
  ("2000305","思品","卫思政",3,1,2000 ),
  ("2000306","历史","蒋历史",3,1,NULL ),
  ("2000307","地理","沈地理",3,1,NULL ),
  ("2000308","生物","韩生物",3,1,NULL ),

  ("2000109","音乐","杨音体美",1,1,NULL ),
  ("2000110","体育","杨音体美",1,1,NULL ),
  ("2000111","美术","杨音体美",1,1,NULL );


INSERT INTO information(student_id, course_id, involved_year, score) VALUES
  ("2018000001","1970101",2010,40),
  ("2018000001","1970102",2010,40),
  ("2018000001","1970103",2010,50),
  ("2018000002","1970101",2010,100),
  ("2018000002","1970102",2010,100),
  ("2018000002","1970103",2010,100),
  ("2018000003","1970101",2010,50),
  ("2018000003","1970102",2010,80),
  ("2018000003","1970103",2010,80),

  ("2010000001","1970101",2010,90),
  ("2010000001","1970102",2010,90),
  ("2010000001","1970103",2010,90),
  ("2010000002","1970101",2010,100),
  ("2010000002","1970102",2010,100),
  ("2010000002","1970103",2010,100),
  ("2010000003","1970101",2010,80),
  ("2010000003","1970102",2010,80),
  ("2010000003","1970103",2010,80),


  ("2010000004","2000304",2010,90),
  ("2010000004","2000305",2010,100),
  ("2010000004","2000306",2010,90),
  ("2010000004","2000307",2010,100),
  ("2010000005","2000304",2010,50),
  ("2010000005","2000305",2010,50),
  ("2010000005","2000306",2010,50),
  ("2010000005","2000307",2010,60),

  ("2010000006","2000109",2010,90),
  ("2010000006","2000110",2010,90),
  ("2010000006","2000111",2010,90),
  ("2010000007","2000109",2010,90),
  ("2010000007","2000110",2010,90),
  ("2010000007","2000111",2010,90);




